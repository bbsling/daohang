<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›¶åº¦ä¹¦ç­¾å¯¼èˆª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --sidebar-bg: #f5f5f5;
            --sidebar-hover: #e0e0e0;
            --card-bg: #f9f9f9;
            --btn-bg: #4285f4;
            --btn-text: #ffffff;
            --modal-bg: rgba(0,0,0,0.5);
            --modal-content-bg: #ffffff;
            --border-color: #ddd;
            --danger-color: #ef4444;
            --import-export-color: #10b981;
            --drag-over-color: #e8f4fd;
            --drag-active-color: #d1e7fd;
            --week-color: #4285f4; 
            --week-weight: 600;
            --icon-color: #4285f4; 
            --undo-bg: #f59e0b; 
            --undo-text: #ffffff;
            --redo-bg: #6366f1; 
            --redo-text: #ffffff;
            --group-bg: #f0f0f0; /* åˆ†ç»„æ ‡é¢˜èƒŒæ™¯è‰² */
            --group-hover: #e5e5e5; /* åˆ†ç»„æ ‡é¢˜æ‚¬æµ®è‰² */
            --group-active: #d9d9d9; /* åˆ†ç»„æ ‡é¢˜ç‚¹å‡»æ¿€æ´»è‰² */
            --transition-ease: cubic-bezier(0.4, 0, 0.2, 1); /* ç»†è…»ç¼“åŠ¨å‡½æ•° */
        }

        .dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #f0f0f0;
            --sidebar-bg: #2d2d2d;
            --sidebar-hover: #3d3d3d;
            --card-bg: #252525;
            --btn-bg: #3367d6;
            --btn-text: #ffffff;
            --modal-content-bg: #2d2d2d;
            --border-color: #444;
            --danger-color: #f87171;
            --import-export-color: #34d399;
            --drag-over-color: #2a3b4c;
            --drag-active-color: #3a4b5c;
            --week-color: #5b9bf3;
            --icon-color: #5b9bf3;
            --undo-bg: #d97706;
            --redo-bg: #4f46e5;
            --group-bg: #222222; /* æ·±è‰²æ¨¡å¼åˆ†ç»„èƒŒæ™¯ */
            --group-hover: #2c2c2c; /* æ·±è‰²æ¨¡å¼åˆ†ç»„æ‚¬æµ® */
            --group-active: #363636; /* æ·±è‰²æ¨¡å¼åˆ†ç»„æ¿€æ´» */
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .time-bar {
            width: 100%;
            height: 30px;
            line-height: 30px;
            text-align: center;
            background-color: var(--sidebar-bg);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .time-icon {
            color: var(--icon-color);
            font-size: 16px;
        }
        .week-tag {
            color: var(--week-color);
            font-weight: var(--week-weight);
            margin-left: 8px;
        }

        .header {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 10px 20px;
            background-color: var(--card-bg);
            flex-wrap: wrap;
        }

        .theme-toggle, .add-bookmark-btn, .import-btn, .export-btn, .clear-btn, .expand-all-btn, .collapse-all-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            color: var(--btn-text);
            cursor: pointer;
            font-size: 14px;
        }

        .theme-toggle {
            background-color: var(--btn-bg);
        }

        .add-bookmark-btn {
            background-color: var(--btn-bg);
        }

        .import-btn, .export-btn {
            background-color: var(--import-export-color);
        }

        .clear-btn {
            background-color: var(--danger-color);
        }

        /* æ–°å¢ï¼šå…¨éƒ¨å±•å¼€/å…¨éƒ¨æŠ˜å æŒ‰é’® */
        .expand-all-btn {
            background-color: #0ea5e9;
        }
        .collapse-all-btn {
            background-color: #f43f5e;
        }

        /* æ’¤é”€é‡åšå®¹å™¨æ ·å¼ */
        .undo-redo-container {
            position: fixed;
            top: 40px;
            right: 20px;
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 8px;
            background-color: var(--card-bg);
            padding: 8px 15px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .undo-btn {
            background-color: var(--undo-bg);
            color: var(--undo-text);
            border: none;
            border-radius: 4px;
            padding: 4px 10px;
            cursor: pointer;
            font-size: 14px;
        }
        .redo-btn {
            background-color: var(--redo-bg);
            color: var(--redo-text);
            border: none;
            border-radius: 4px;
            padding: 4px 10px;
            cursor: pointer;
            font-size: 14px;
        }
        .undo-redo-text {
            font-size: 14px;
        }
        .undo-redo-close {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 16px;
        }

        #import-input {
            display: none;
        }

        .main-container {
            display: flex;
            flex: 1;
        }

        .sidebar {
            width: 60px;
            background-color: var(--sidebar-bg);
            padding: 20px 0;
            transition: width 0.3s;
            overflow: hidden;
            white-space: nowrap;
        }

        .sidebar:hover, .sidebar.active {
            width: 200px;
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-item:hover {
            background-color: var(--sidebar-hover);
        }

        .nav-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .content {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .search-box {
            width: 100%;
            max-width: 600px;
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
        }

        #search-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .search-btn {
            padding: 0 15px;
            border: none;
            border-radius: 4px;
            background-color: var(--btn-bg);
            color: var(--btn-text);
            cursor: pointer;
        }

        /* ä¹¦ç­¾åˆ†ç»„æ ·å¼ - äº¤äº’ä¼˜åŒ–æ ¸å¿ƒ */
        .bookmark-group-container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 25px; /* åˆ†ç»„ä¹‹é—´çš„é—´è· */
        }

        /* åˆ†ç»„æ ‡é¢˜æ  - å¼ºåŒ–äº¤äº’åé¦ˆ */
        .bookmark-group-title {
            width: 100%;
            padding: 12px 20px;
            background-color: var(--group-bg);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.2s var(--transition-ease); /* å¤šå±æ€§ç»Ÿä¸€è¿‡æ¸¡ */
            font-size: 16px;
            font-weight: 600;
            user-select: none; /* ç¦æ­¢æ–‡å­—é€‰ä¸­ï¼Œæå‡äº¤äº’ä½“éªŒ */
            position: relative;
        }

        /* æ‚¬æµ®æ•ˆæœ */
        .bookmark-group-title:hover {
            background-color: var(--group-hover);
            transform: translateY(-1px); /* è½»å¾®ä¸Šæµ®ï¼Œå¢å¼ºæ„ŸçŸ¥ */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* è½»å¾®é˜´å½± */
        }

        /* ç‚¹å‡»æŒ‰å‹æ•ˆæœ */
        .bookmark-group-title:active {
            background-color: var(--group-active);
            transform: translateY(0); /* å¤ä½ï¼Œæ¨¡æ‹ŸæŒ‰å‹ */
            box-shadow: 0 1px 2px rgba(0,0,0,0.1); /* é˜´å½±ç¼©å° */
        }

        /* åˆ†ç»„æ ‡é¢˜å·¦ä¾§ï¼ˆå›¾æ ‡+æ–‡å­—ï¼‰ */
        .group-title-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .group-icon {
            font-size: 20px;
            color: var(--icon-color);
            transition: transform 0.2s var(--transition-ease);
        }

        /* åˆ†ç»„æ ‡é¢˜æ‚¬æµ®æ—¶ï¼Œå›¾æ ‡è½»å¾®æ”¾å¤§ */
        .bookmark-group-title:hover .group-icon {
            transform: scale(1.1);
        }

        /* æŠ˜å /å±•å¼€å›¾æ ‡ - ä¼˜åŒ–è§†è§‰æç¤º */
        .group-collapse-icon {
            font-size: 18px;
            color: var(--icon-color);
            transition: all 0.3s var(--transition-ease); /* æ—‹è½¬+é€æ˜åº¦è¿‡æ¸¡ */
            opacity: 0.8;
        }

        /* æ‚¬æµ®æ—¶å›¾æ ‡é«˜äº® */
        .bookmark-group-title:hover .group-collapse-icon {
            opacity: 1;
            transform: scale(1.1);
        }

        /* æŠ˜å çŠ¶æ€ä¸‹å›¾æ ‡æ—‹è½¬+å¤ä½ */
        .bookmark-group.collapsed .group-collapse-icon {
            transform: rotate(-90deg) scale(1);
            opacity: 0.7;
        }

        /* åˆ†ç»„å†…å®¹å®¹å™¨ - ç»†è…»æŠ˜å åŠ¨ç”» */
        .bookmark-group-content {
            width: 100%;
            overflow: hidden;
            transition: all 0.5s var(--transition-ease); /* é«˜åº¦+é€æ˜åº¦+å†…è¾¹è·è¿‡æ¸¡ */
            max-height: 2000px; /* è¶³å¤Ÿå¤§çš„é»˜è®¤é«˜åº¦ */
            opacity: 1;
            padding: 15px 0;
        }

        /* æŠ˜å çŠ¶æ€ä¸‹ - å¤šå±æ€§è¿‡æ¸¡ï¼Œæ›´ç»†è…» */
        .bookmark-group.collapsed .bookmark-group-content {
            max-height: 0;
            opacity: 0; /* é€æ˜åŒ–ï¼Œé¿å…å†…å®¹æ®‹ç•™è§†è§‰ */
            padding: 0; /* å†…è¾¹è·å¤ä½ï¼Œæ¶ˆé™¤æŠ˜å åç©ºç™½ */
        }

        /* ä¹¦ç­¾å¡ç‰‡å®¹å™¨ï¼ˆåµŒå¥—åœ¨åˆ†ç»„å†…ï¼‰ */
        .bookmark-container {
            width: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .bookmark-card {
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 8px;
            text-align: center;
            transition: transform 0.2s, background-color 0.2s;
            position: relative;
            cursor: grab;
        }

        .bookmark-card:active {
            cursor: grabbing;
        }

        .bookmark-card:hover {
            transform: translateY(-5px);
        }

        .bookmark-card a {
            color: var(--text-color);
            text-decoration: none;
        }

        .bookmark-card.drag-over {
            background-color: var(--drag-over-color);
            border: 2px dashed var(--btn-bg);
        }

        .bookmark-card.dragging {
            opacity: 0.5;
            background-color: var(--drag-active-color);
        }

        .bookmark-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: none;
            gap: 5px;
        }

        .bookmark-card:hover .bookmark-actions {
            display: flex;
        }

        .edit-btn, .delete-btn {
            padding: 2px 5px;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-size: 12px;
            color: var(--btn-text);
        }

        .edit-btn {
            background-color: #f59e0b;
        }

        .delete-btn {
            background-color: var(--danger-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-bg);
            z-index: 999;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--modal-content-bg);
            padding: 25px;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
        }

        .modal-title {
            margin-bottom: 20px;
            font-size: 18px;
            text-align: center;
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .modal-form label {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .modal-form input, .modal-form select {
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .modal-btns {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 10px;
        }

        .modal-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: var(--btn-text);
        }

        .confirm-btn {
            background-color: var(--btn-bg);
        }

        .cancel-btn {
            background-color: #6b7280;
        }

        .footer {
            margin-top: auto;
            padding: 20px;
            text-align: center;
            background-color: var(--sidebar-bg);
        }

        .friend-links {
            margin-top: 10px;
        }

        .friend-links a {
            color: var(--btn-bg);
            text-decoration: none;
            margin: 0 8px;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                display: flex;
                overflow-x: auto;
            }
            .sidebar:hover, .sidebar.active {
                width: 100%;
            }
            .content {
                padding: 20px 15px;
            }
            .header {
                justify-content: center;
            }
            .undo-redo-container {
                top: 10px;
                right: 10px;
                width: calc(100% - 20px);
                justify-content: center;
            }
            .bookmark-container {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="time-bar" id="time-bar">
        <span class="time-icon">ğŸ“…</span>
        <span id="datetime-text"></span>
        <span class="week-tag" id="week-text"></span>
    </div>

    <!-- æ’¤é”€é‡åšå®¹å™¨ -->
    <div class="undo-redo-container" id="undo-redo-container">
        <span class="undo-redo-text" id="undo-redo-text">ä¹¦ç­¾å·²åˆ é™¤</span>
        <button class="undo-btn" id="undo-btn">æ’¤é”€åˆ é™¤</button>
        <button class="redo-btn" id="redo-btn" style="display:none">é‡åšåˆ é™¤</button>
        <button class="undo-redo-close" id="undo-redo-close-btn">Ã—</button>
    </div>

    <div class="header">
        <button class="theme-toggle" id="theme-toggle">åˆ‡æ¢æ·±è‰²æ¨¡å¼</button>
        <button class="add-bookmark-btn" id="add-bookmark-btn">æ–°å¢ä¹¦ç­¾</button>
        <button class="import-btn" id="import-btn">å¯¼å…¥ä¹¦ç­¾</button>
        <button class="export-btn" id="export-btn">å¯¼å‡ºä¹¦ç­¾</button>
        <button class="clear-btn" id="clear-btn">æ¸…ç©ºå…¨éƒ¨</button>
        <!-- æ–°å¢ï¼šå…¨éƒ¨å±•å¼€/å…¨éƒ¨æŠ˜å æŒ‰é’® -->
        <button class="expand-all-btn" id="expand-all-btn">å…¨éƒ¨å±•å¼€</button>
        <button class="collapse-all-btn" id="collapse-all-btn">å…¨éƒ¨æŠ˜å </button>
        <input type="file" id="import-input" accept=".json">
    </div>

    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <div class="nav-item" data-category="all">
                <span class="nav-icon">ğŸ“‹</span>
                <span class="nav-text">å…¨éƒ¨ä¹¦ç­¾</span>
            </div>
            <div class="nav-item" data-category="common">
                <span class="nav-icon">ğŸ“Œ</span>
                <span class="nav-text">å¸¸ç”¨ä¹¦ç­¾</span>
            </div>
            <div class="nav-item" data-category="dev">
                <span class="nav-icon">ğŸ’»</span>
                <span class="nav-text">å¼€å‘å·¥å…·</span>
            </div>
            <div class="nav-item" data-category="study">
                <span class="nav-icon">ğŸ“š</span>
                <span class="nav-text">å­¦ä¹ èµ„æº</span>
            </div>
            <div class="nav-item" data-category="design">
                <span class="nav-icon">ğŸ¨</span>
                <span class="nav-text">è®¾è®¡ç½‘ç«™</span>
            </div>
        </div>

        <div class="content">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="æœç´¢æœ¬åœ°ä¹¦ç­¾æˆ–å¿…åº”æœç´¢...">
                <button class="search-btn" id="local-search-btn">æœ¬åœ°æœç´¢</button>
                <button class="search-btn" id="bing-search-btn">å¿…åº”æœç´¢</button>
            </div>

            <!-- ä¹¦ç­¾åˆ†ç»„å®¹å™¨ -->
            <div class="bookmark-group-container" id="bookmark-group-container">
                <!-- åˆ†ç»„å†…å®¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="copyright">Copyright Â© é›¶åº¦å¯¼èˆª 2024-2025 æ¡‚ICPå¤‡17008865å·-1</div>
        <div class="friend-links">
            <a href="https://0do.top/" target="_blank">é›¶åº¦ä¸»é¡µ</a>
            <a href="https://dh.0do.top/" target="_blank">é›¶åº¦å¯¼èˆª</a>
            <a href="https://0do.top/music/" target="_blank">éŸ³ä¹è§£æ</a>
        </div>
    </div>

    <div class="modal" id="bookmark-modal">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-title">æ–°å¢ä¹¦ç­¾</h3>
            <form class="modal-form" id="bookmark-form">
                <input type="hidden" id="bookmark-id">
                <label>
                    ä¹¦ç­¾åç§°
                    <input type="text" id="bookmark-name" required placeholder="ä¾‹å¦‚ï¼šGitHub">
                </label>
                <label>
                    ä¹¦ç­¾é“¾æ¥
                    <input type="url" id="bookmark-url" required placeholder="ä¾‹å¦‚ï¼šhttps://github.com">
                </label>
                <label>
                    ä¹¦ç­¾æè¿°
                    <input type="text" id="bookmark-desc" placeholder="ä¾‹å¦‚ï¼šä»£ç æ‰˜ç®¡å¹³å°">
                </label>
                <label>
                    ä¹¦ç­¾åˆ†ç±»
                    <select id="bookmark-category" required>
                        <option value="common">å¸¸ç”¨ä¹¦ç­¾</option>
                        <option value="dev">å¼€å‘å·¥å…·</option>
                        <option value="study">å­¦ä¹ èµ„æº</option>
                        <option value="design">è®¾è®¡ç½‘ç«™</option>
                    </select>
                </label>
                <div class="modal-btns">
                    <button type="button" class="modal-btn cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>
                    <button type="submit" class="modal-btn confirm-btn">ç¡®è®¤</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ========== åŸºç¡€é…ç½® ==========
        const BOOKMARK_KEY = 'my_nav_bookmarks';
        const MAX_HISTORY_STEPS = 10;
        let undoStack = [];
        let redoStack = [];
        let historyTimer = null;
        const HISTORY_DURATION = 8000;

        // åˆ†ç±»é…ç½®
        const categoryConfig = {
            common: { name: 'å¸¸ç”¨ä¹¦ç­¾', icon: 'ğŸ“Œ', defaultExpanded: true },
            dev: { name: 'å¼€å‘å·¥å…·', icon: 'ğŸ’»', defaultExpanded: true },
            study: { name: 'å­¦ä¹ èµ„æº', icon: 'ğŸ“š', defaultExpanded: true },
            design: { name: 'è®¾è®¡ç½‘ç«™', icon: 'ğŸ¨', defaultExpanded: true }
        };

        // æŠ˜å çŠ¶æ€å­˜å‚¨
        const COLLAPSE_STATE_KEY = 'bookmark_group_collapse_states';

        // 1. åˆå§‹åŒ–é»˜è®¤ä¹¦ç­¾æ•°æ®
        const defaultBookmarks = [
            { id: 2, name: 'ip111æŸ¥è¯¢', url: 'https://ip111.cn/', desc: 'IP111æŸ¥è¯¢', category: 'common' },
            { id: 1, name: 'ç™¾åº¦ç½‘ç›˜', url: 'https://pan.baidu.com/', desc: 'ç™¾åº¦ç½‘ç›˜', category: 'common' },
            { id: 3, name: 'èµ›åšæ´»ä½›', url: 'https://www.cloudflare.com/', desc: 'å°é»„äº‘', category: 'dev' },
            { id: 4, name: '123äº‘ç›˜', url: 'https://www.123pan.com/', desc: '123äº‘ç›˜', category: 'common' },
            { id: 5, name: 'å¤¸å…‹ç½‘ç›˜', url: 'https://pan.quark.cn/list#/list/all', desc: 'å¤¸å…‹ç½‘ç›˜', category: 'common' },
            { id: 6, name: 'ä¼˜è®¾å¯¼èˆª', url: 'https://hao.uisdc.com/', desc: 'ä¼˜è®¾å¯¼èˆª', category: 'design' },
            { id: 7, name: 'ä»Šæ—¥çƒ­æ¦œ', url: 'https://adzhp.cc/hotnews/', desc: 'ä»Šæ—¥çƒ­æ¦œ', category: 'common' },
            { id: 8, name: '423Down', url: 'https://www.423down.com/', desc: '423Down', category: 'study' }
        ];

        // 2. è·å–localStorageä¸­çš„ä¹¦ç­¾
        function getBookmarks() {
            const stored = localStorage.getItem(BOOKMARK_KEY);
            return stored ? JSON.parse(stored) : defaultBookmarks;
        }

        // 3. ä¿å­˜ä¹¦ç­¾åˆ°localStorage
        function saveBookmarks(bookmarks) {
            localStorage.setItem(BOOKMARK_KEY, JSON.stringify(bookmarks));
            // ä¿å­˜åæ›´æ–°åˆ†ç»„ä¹¦ç­¾æ•°é‡
            renderBookmarkGroups();
        }

        // 4. è·å–åˆ†ç»„æŠ˜å çŠ¶æ€
        function getCollapseStates() {
            const stored = localStorage.getItem(COLLAPSE_STATE_KEY);
            return stored ? JSON.parse(stored) : getDefaultCollapseStates();
        }

        // 5. è·å–é»˜è®¤æŠ˜å çŠ¶æ€
        function getDefaultCollapseStates() {
            const states = {};
            Object.keys(categoryConfig).forEach(catKey => {
                states[catKey] = !categoryConfig[catKey].defaultExpanded;
            });
            return states;
        }

        // 6. ä¿å­˜åˆ†ç»„æŠ˜å çŠ¶æ€
        function saveCollapseStates(states) {
            localStorage.setItem(COLLAPSE_STATE_KEY, JSON.stringify(states));
        }

        // 7. åˆ‡æ¢åˆ†ç»„æŠ˜å çŠ¶æ€ - ä¼˜åŒ–ï¼šæ·»åŠ æ»šåŠ¨å®šä½
        function toggleGroupCollapse(catKey) {
            const collapseStates = getCollapseStates();
            // åˆ‡æ¢çŠ¶æ€
            collapseStates[catKey] = !collapseStates[catKey];
            // ä¿å­˜çŠ¶æ€
            saveCollapseStates(collapseStates);
            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            const groupElement = document.getElementById(`bookmark-group-${catKey}`);
            if (groupElement) {
                groupElement.classList.toggle('collapsed', collapseStates[catKey]);
                // ä¼˜åŒ–ï¼šè‡ªåŠ¨æ»šåŠ¨åˆ°åˆ†ç»„æ ‡é¢˜ï¼ˆå¹³æ»‘æ»šåŠ¨ï¼‰
                const groupTitle = groupElement.querySelector('.bookmark-group-title');
                groupTitle.scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest'
                });
                // æ·»åŠ çŸ­æš‚é«˜äº®æç¤ºï¼Œå¼ºåŒ–äº¤äº’åé¦ˆ
                groupTitle.style.backgroundColor = 'var(--btn-bg)';
                groupTitle.style.color = 'var(--btn-text)';
                setTimeout(() => {
                    groupTitle.style.backgroundColor = '';
                    groupTitle.style.color = '';
                }, 200);
            }
        }

        // æ–°å¢ï¼šå…¨éƒ¨å±•å¼€åˆ†ç»„
        function expandAllGroups() {
            const collapseStates = getCollapseStates();
            Object.keys(categoryConfig).forEach(catKey => {
                collapseStates[catKey] = false; // å…¨éƒ¨å±•å¼€ï¼ˆcollapsed=falseï¼‰
            });
            saveCollapseStates(collapseStates);
            renderBookmarkGroups();
            // æç¤ºä¿¡æ¯
            showUndoRedoContainer('æ‰€æœ‰åˆ†ç»„å·²å±•å¼€');
        }

        // æ–°å¢ï¼šå…¨éƒ¨æŠ˜å åˆ†ç»„
        function collapseAllGroups() {
            const collapseStates = getCollapseStates();
            Object.keys(categoryConfig).forEach(catKey => {
                collapseStates[catKey] = true; // å…¨éƒ¨æŠ˜å ï¼ˆcollapsed=trueï¼‰
            });
            saveCollapseStates(collapseStates);
            renderBookmarkGroups();
            // æç¤ºä¿¡æ¯
            showUndoRedoContainer('æ‰€æœ‰åˆ†ç»„å·²æŠ˜å ');
        }

        // 8. æ¸²æŸ“ä¹¦ç­¾åˆ†ç»„ - ä¼˜åŒ–ï¼šæ”¯æŒåŒå‡»æŠ˜å /å±•å¼€
        function renderBookmarkGroups() {
            const groupContainer = document.getElementById('bookmark-group-container');
            const bookmarks = getBookmarks();
            const collapseStates = getCollapseStates();
            groupContainer.innerHTML = '';

            // æŒ‰åˆ†ç±»åˆ†ç»„ä¹¦ç­¾
            const groupedBookmarks = {};
            Object.keys(categoryConfig).forEach(catKey => {
                groupedBookmarks[catKey] = bookmarks.filter(bookmark => bookmark.category === catKey);
            });

            // éå†æ¯ä¸ªåˆ†ç±»ï¼Œç”Ÿæˆåˆ†ç»„
            Object.keys(categoryConfig).forEach(catKey => {
                const catInfo = categoryConfig[catKey];
                const catBookmarks = groupedBookmarks[catKey] || [];
                const isCollapsed = collapseStates[catKey];

                // åˆ›å»ºåˆ†ç»„å®¹å™¨
                const groupDiv = document.createElement('div');
                groupDiv.id = `bookmark-group-${catKey}`;
                groupDiv.className = `bookmark-group ${isCollapsed ? 'collapsed' : ''}`;

                // åˆ†ç»„HTMLç»“æ„
                groupDiv.innerHTML = `
                    <!-- åˆ†ç»„æ ‡é¢˜æ ï¼ˆæ”¯æŒç‚¹å‡»/åŒå‡»æŠ˜å /å±•å¼€ï¼‰ -->
                    <div class="bookmark-group-title" onclick="toggleGroupCollapse('${catKey}')" ondblclick="toggleGroupCollapse('${catKey}')">
                        <div class="group-title-left">
                            <span class="group-icon">${catInfo.icon}</span>
                            <span class="group-name">${catInfo.name}ï¼ˆ${catBookmarks.length}ä¸ªï¼‰</span>
                        </div>
                        <span class="group-collapse-icon">â–¶</span>
                    </div>
                    <!-- åˆ†ç»„å†…å®¹å®¹å™¨ -->
                    <div class="bookmark-group-content">
                        <div class="bookmark-container" id="bookmark-container-${catKey}">
                            <!-- ä¹¦ç­¾å¡ç‰‡ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                `;

                // æ·»åŠ åˆ°åˆ†ç»„å®¹å™¨
                groupContainer.appendChild(groupDiv);

                // æ¸²æŸ“å½“å‰åˆ†ç»„ä¸‹çš„ä¹¦ç­¾å¡ç‰‡
                const bookmarkContainer = document.getElementById(`bookmark-container-${catKey}`);
                bookmarkContainer.innerHTML = '';
                catBookmarks.forEach(bookmark => {
                    const card = document.createElement('div');
                    card.className = 'bookmark-card';
                    card.dataset.id = bookmark.id;
                    card.dataset.category = bookmark.category;
                    card.draggable = true;
                    card.innerHTML = `
                        <div class="bookmark-actions">
                            <button class="edit-btn" onclick="openEditModal(${bookmark.id})">ç¼–è¾‘</button>
                            <button class="delete-btn" onclick="deleteBookmark(${bookmark.id})">åˆ é™¤</button>
                        </div>
                        <a href="${bookmark.url}" target="_blank">
                            <h3>${bookmark.name}</h3>
                            <p>${bookmark.desc || 'æ— æè¿°'}</p>
                        </a>
                    `;
                    bookmarkContainer.appendChild(card);
                });
            });

            // ç»‘å®šæ‹–æ‹½äº‹ä»¶
            bindDragEvents();
            // æ›´æ–°æ’¤é”€é‡åšæŒ‰é’®çŠ¶æ€
            updateUndoRedoBtnState();
        }

        // ========== æ‹–æ‹½æ’åºæ ¸å¿ƒåŠŸèƒ½ ==========
        let draggedCard = null;

        function bindDragEvents() {
            const allCards = document.querySelectorAll('.bookmark-card');
            const allContainers = document.querySelectorAll('.bookmark-container');

            allCards.forEach(card => {
                card.addEventListener('dragstart', (e) => {
                    draggedCard = card;
                    card.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', card.dataset.id);
                    setTimeout(() => {
                        card.style.opacity = '0.5';
                    }, 0);
                });

                card.addEventListener('dragend', () => {
                    draggedCard.classList.remove('dragging');
                    card.style.opacity = '1';
                    draggedCard = null;
                    allCards.forEach(c => c.classList.remove('drag-over'));
                });

                card.addEventListener('dragenter', (e) => {
                    e.preventDefault();
                    if (card !== draggedCard) {
                        card.classList.add('drag-over');
                    }
                });

                card.addEventListener('dragleave', () => {
                    card.classList.remove('drag-over');
                });

                card.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                card.addEventListener('drop', (e) => {
                    e.preventDefault();
                    card.classList.remove('drag-over');
                    if (card === draggedCard) return;

                    const draggedId = draggedCard.dataset.id;
                    const targetId = card.dataset.id;
                    reorderBookmarks(draggedId, targetId);
                });
            });
        }

        function reorderBookmarks(draggedId, targetId) {
            let bookmarks = getBookmarks();
            const draggedIndex = bookmarks.findIndex(item => item.id == draggedId);
            const targetIndex = bookmarks.findIndex(item => item.id == targetId);
            [bookmarks[draggedIndex], bookmarks[targetIndex]] = [bookmarks[targetIndex], bookmarks[draggedIndex]];
            saveBookmarks(bookmarks);
            renderBookmarkGroups();
        }

        // ========== å¯¼å…¥å¯¼å‡º+æ¸…ç©ºåŠŸèƒ½ ==========
        const importBtn = document.getElementById('import-btn');
        const exportBtn = document.getElementById('export-btn');
        const clearBtn = document.getElementById('clear-btn');
        const importInput = document.getElementById('import-input');
        // ç»‘å®šå…¨éƒ¨å±•å¼€/æŠ˜å æŒ‰é’®äº‹ä»¶
        const expandAllBtn = document.getElementById('expand-all-btn');
        const collapseAllBtn = document.getElementById('collapse-all-btn');
        expandAllBtn.addEventListener('click', expandAllGroups);
        collapseAllBtn.addEventListener('click', collapseAllGroups);

        exportBtn.addEventListener('click', () => {
            const bookmarks = getBookmarks();
            const blob = new Blob([JSON.stringify(bookmarks, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `my_bookmarks_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
            a.click();
            URL.revokeObjectURL(url);
        });

        importBtn.addEventListener('click', () => {
            importInput.click();
        });

        importInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const importedBookmarks = JSON.parse(event.target.result);
                    if (Array.isArray(importedBookmarks) && importedBookmarks.every(item => item.id && item.name && item.url)) {
                        saveBookmarks(importedBookmarks);
                        renderBookmarkGroups();
                        undoStack = [];
                        redoStack = [];
                        hideUndoRedoContainer();
                        alert('ä¹¦ç­¾å¯¼å…¥æˆåŠŸï¼');
                    } else {
                        alert('å¯¼å…¥æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·ç¡®ä¿æ˜¯åˆæ³•çš„ä¹¦ç­¾JSONæ–‡ä»¶');
                    }
                } catch (err) {
                    alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶è§£æé”™è¯¯');
                }
            };
            reader.readAsText(file);
            importInput.value = '';
        });

        clearBtn.addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä¹¦ç­¾å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem(BOOKMARK_KEY);
                renderBookmarkGroups();
                undoStack = [];
                redoStack = [];
                hideUndoRedoContainer();
                alert('ä¹¦ç­¾å·²æ¸…ç©ºï¼Œæ¢å¤ä¸ºé»˜è®¤ä¹¦ç­¾');
            }
        });

        // ========== æ’¤é”€é‡åšæ ¸å¿ƒåŠŸèƒ½ ==========
        const undoRedoContainer = document.getElementById('undo-redo-container');
        const undoBtn = document.getElementById('undo-btn');
        const redoBtn = document.getElementById('redo-btn');
        const undoRedoText = document.getElementById('undo-redo-text');
        const undoRedoCloseBtn = document.getElementById('undo-redo-close-btn');

        function showUndoRedoContainer(text) {
            if (historyTimer) clearTimeout(historyTimer);
            undoRedoText.textContent = text;
            undoRedoContainer.style.display = 'flex';
            historyTimer = setTimeout(() => {
                hideUndoRedoContainer();
            }, HISTORY_DURATION);
        }

        function hideUndoRedoContainer() {
            undoRedoContainer.style.display = 'none';
            if (historyTimer) clearTimeout(historyTimer);
        }

        function updateUndoRedoBtnState() {
            undoBtn.style.display = undoStack.length > 0 ? 'block' : 'none';
            redoBtn.style.display = redoStack.length > 0 ? 'block' : 'none';
        }

        function undoDelete() {
            if (undoStack.length === 0) return;
            const restoredBookmark = undoStack.pop();
            redoStack.push(restoredBookmark);
            if (redoStack.length > MAX_HISTORY_STEPS) redoStack.shift();
            let bookmarks = getBookmarks();
            bookmarks.push(restoredBookmark);
            saveBookmarks(bookmarks);
            renderBookmarkGroups();
            showUndoRedoContainer(`å·²æ¢å¤ã€${restoredBookmark.name}ã€‘`);
        }

        function redoDelete() {
            if (redoStack.length === 0) return;
            const redoBookmark = redoStack.pop();
            undoStack.push(redoBookmark);
            if (undoStack.length > MAX_HISTORY_STEPS) undoStack.shift();
            let bookmarks = getBookmarks();
            bookmarks = bookmarks.filter(item => item.id !== redoBookmark.id);
            saveBookmarks(bookmarks);
            renderBookmarkGroups();
            showUndoRedoContainer(`å·²å†æ¬¡åˆ é™¤ã€${redoBookmark.name}ã€‘`);
        }

        undoBtn.addEventListener('click', undoDelete);
        redoBtn.addEventListener('click', redoDelete);
        undoRedoCloseBtn.addEventListener('click', hideUndoRedoContainer);

        // ========== æ—¶é—´æ ä¼˜åŒ– ==========
        function updateTime() {
            const now = new Date();
            const weekDays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            const weekDay = weekDays[now.getDay()];
            const datetimeStr = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('datetime-text').textContent = datetimeStr;
            document.getElementById('week-text').textContent = weekDay;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // ========== æ·±æµ…è‰²æ¨¡å¼åˆ‡æ¢ ==========
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;

        if (localStorage.getItem('theme') === 'dark') {
            body.classList.add('dark-mode');
            themeToggle.textContent = 'åˆ‡æ¢æµ…è‰²æ¨¡å¼';
        }

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            if (body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
                themeToggle.textContent = 'åˆ‡æ¢æµ…è‰²æ¨¡å¼';
            } else {
                localStorage.setItem('theme', 'light');
                themeToggle.textContent = 'åˆ‡æ¢æ·±è‰²æ¨¡å¼';
            }
        });

        // ========== ä¾§è¾¹æ åˆ†ç±»ç­›é€‰ ==========
        const sidebar = document.getElementById('sidebar');
        const navItems = document.querySelectorAll('.nav-item');

        function filterBookmarks(category) {
            const allGroups = document.querySelectorAll('.bookmark-group');
            const allCards = document.querySelectorAll('.bookmark-card');

            if (category === 'all') {
                allGroups.forEach(group => group.style.display = 'block');
                allCards.forEach(card => card.style.display = 'block');
            } else {
                allGroups.forEach(group => {
                    if (group.id === `bookmark-group-${category}`) {
                        group.style.display = 'block';
                        const groupCards = group.querySelectorAll('.bookmark-card');
                        groupCards.forEach(card => card.style.display = 'block');
                    } else {
                        group.style.display = 'none';
                    }
                });
            }
        }

        navItems.forEach(item => {
            item.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                filterBookmarks(item.dataset.category);
            });
            item.addEventListener('mouseenter', () => {
                filterBookmarks(item.dataset.category);
            });
        });

        // ========== æœç´¢åŠŸèƒ½ ==========
        const searchInput = document.getElementById('search-input');
        const localSearchBtn = document.getElementById('local-search-btn');
        const bingSearchBtn = document.getElementById('bing-search-btn');

        localSearchBtn.addEventListener('click', () => {
            const keyword = searchInput.value.trim().toLowerCase();
            if (!keyword) {
                document.querySelectorAll('.bookmark-card').forEach(card => card.style.display = 'block');
                return;
            }

            const allCards = document.querySelectorAll('.bookmark-card');
            allCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                const group = card.closest('.bookmark-group');
                const isGroupVisible = group.style.display !== 'none';

                if (isGroupVisible && text.includes(keyword)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        bingSearchBtn.addEventListener('click', () => {
            const keyword = searchInput.value.trim();
            if (keyword) {
                const url = `https://cn.bing.com/search?q=${encodeURIComponent(keyword)}`;
                window.open(url, '_blank');
            }
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                localSearchBtn.click();
            }
        });

        // ========== ä¹¦ç­¾ç®¡ç†å¼¹çª—åŠŸèƒ½ ==========
        const modal = document.getElementById('bookmark-modal');
        const addBookmarkBtn = document.getElementById('add-bookmark-btn');
        const bookmarkForm = document.getElementById('bookmark-form');
        const modalTitle = document.getElementById('modal-title');
        let currentBookmarkId = null;

        addBookmarkBtn.addEventListener('click', () => {
            modalTitle.textContent = 'æ–°å¢ä¹¦ç­¾';
            currentBookmarkId = null;
            bookmarkForm.reset();
            modal.style.display = 'flex';
        });

        function openEditModal(id) {
            currentBookmarkId = id;
            const bookmarks = getBookmarks();
            const bookmark = bookmarks.find(item => item.id === id);
            if (bookmark) {
                modalTitle.textContent = 'ç¼–è¾‘ä¹¦ç­¾';
                document.getElementById('bookmark-id').value = bookmark.id;
                document.getElementById('bookmark-name').value = bookmark.name;
                document.getElementById('bookmark-url').value = bookmark.url;
                document.getElementById('bookmark-desc').value = bookmark.desc;
                document.getElementById('bookmark-category').value = bookmark.category;
                modal.style.display = 'flex';
            }
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function deleteBookmark(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¹¦ç­¾å—ï¼Ÿ')) {
                let bookmarks = getBookmarks();
                const deletedBookmark = bookmarks.find(item => item.id === id);
                if (!deletedBookmark) return;
                undoStack.push(deletedBookmark);
                if (undoStack.length > MAX_HISTORY_STEPS) undoStack.shift();
                redoStack = [];
                bookmarks = bookmarks.filter(item => item.id !== id);
                saveBookmarks(bookmarks);
                renderBookmarkGroups();
                showUndoRedoContainer(`ä¹¦ç­¾ã€${deletedBookmark.name}ã€‘å·²åˆ é™¤`);
            }
        }

        bookmarkForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = currentBookmarkId || Date.now();
            const name = document.getElementById('bookmark-name').value;
            const url = document.getElementById('bookmark-url').value;
            const desc = document.getElementById('bookmark-desc').value;
            const category = document.getElementById('bookmark-category').value;
            
            let bookmarks = getBookmarks();
            if (currentBookmarkId) {
                bookmarks = bookmarks.map(item => item.id === currentBookmarkId ? { id, name, url, desc, category } : item);
            } else {
                bookmarks.push({ id, name, url, desc, category });
            }
            redoStack = [];
            saveBookmarks(bookmarks);
            renderBookmarkGroups();
            closeModal();
        });

        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // ========== é¡µé¢åˆå§‹åŒ– ==========
        window.addEventListener('DOMContentLoaded', () => {
            renderBookmarkGroups();
        });
    </script>
</body>
</html>
